#!/bin/bash
set -euo pipefail

usage()
{
  echo "Usage: $0 {add|remove}"
  exit 1
}

if [[ $# -ne 2 ]]; then
  usage
fi

ACTION=$1

do_add() {
  if [ -f /usr/share/vulkan/icd.d/nvidia_icd.json.bak ]; then
    mv /usr/share/vulkan/icd.d/nvidia_icd.json.bak /usr/share/vulkan/icd.d/nvidia_icd.json
  fi
}

do_remove() {
  if [ -f /usr/share/vulkan/icd.d/nvidia_icd.json ]; then
    mv /usr/share/vulkan/icd.d/nvidia_icd.json /usr/share/vulkan/icd.d/nvidia_icd.json.bak
  fi
}

case "${ACTION}" in
  add)
    do_add
    ;;
  remove)
    do_remove
    ;;
  *)
    usage
    ;;
esac
